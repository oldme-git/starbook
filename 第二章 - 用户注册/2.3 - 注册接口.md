## 添加注册Api

*api/users/v1/users.go*

```go
package v1

import "github.com/gogf/gf/v2/frame/g"

type RegisterReq struct {
    g.Meta `path:"users/register" method:"post"`
}

type RegisterRes struct {
}
```

新增一个注册用户的接口，接口地址为`/users/register`，请求方式为`POST`。
执行命令生成`Api`对应的`Controller`：

```bash
$ gf gen ctrl
generated: D:\project\star\api\users\users.go
generated: internal\controller\users\users.go
generated: internal\controller\users\users_new.go
generated: internal\controller\users\users_v1_register.go
done!
```

> 如果你已经安装了[GoFrame Helper](https://plugins.jetbrains.com/plugin/23324-goframe-helper)插件，会自动执行`gf gen ctrl`命令。如果你没有安装插件，可以参照官网[教程配置](https://goframe.org/docs/cli/gen-ctrl#%E8%87%AA%E5%8A%A8%E6%A8%A1%E5%BC%8F%E6%8E%A8%E8%8D%90)自动生成。

---

## 注册控制器

*internal/cmd/cmd.go*

```go
package cmd

·
·
·

var (
    Main = gcmd.Command{
        Name:  "main",
        Usage: "main",
        Brief: "start http server",
        Func: func(ctx context.Context, parser *gcmd.Parser) (err error) {
            s := g.Server()
            s.Group("/", func(group *ghttp.RouterGroup) {
                group.Middleware(ghttp.MiddlewareHandlerResponse)
                group.Group("/v1", func(group *ghttp.RouterGroup) {
                    group.Bind(
                        users.NewV1(),
                    )
                })
            })
            s.Run()
            return nil
        },
    }
)
```

完成运行项目：

```bash
$ gf run main.go
build: .\main.go
go build -o .\main.exe  .\main.go
.\main.exe 
build running pid: 8648
2024-11-08 10:36:48.013 [INFO] pid[8648]: http server started listening on [:8000]
2024-11-08 10:36:48.013 [INFO] {e05c16b565dd0518360ebe639e1c623d} swagger ui is serving at address: http://127.0.0.1:8000/swagger/
2024-11-08 10:36:48.014 [INFO] {e05c16b565dd0518360ebe639e1c623d} openapi specification is serving at address: http://127.0.0.1:8000/api.json

  ADDRESS | METHOD |       ROUTE        |                         HANDLER                         |           MIDDLEWARE
----------|--------|--------------------|---------------------------------------------------------|----------------------------------
  :8000   | ALL    | /api.json          | github.com/gogf/gf/v2/net/ghttp.(*Server).openapiSpec   |
----------|--------|--------------------|---------------------------------------------------------|----------------------------------
  :8000   | ALL    | /swagger/*         | github.com/gogf/gf/v2/net/ghttp.(*Server).swaggerUI     | HOOK_BEFORE_SERVE
----------|--------|--------------------|---------------------------------------------------------|----------------------------------
  :8000   | POST   | /v1/users/register | star/internal/controller/users.(*ControllerV1).Register | ghttp.MiddlewareHandlerResponse
----------|--------|--------------------|---------------------------------------------------------|----------------------------------
```

在接口列表中，看到了我们的第一个接口`/v1/users/register`。发起一个`POST`请求：

```bash
$ curl -X POST http://127.0.0.1:8000/v1/users/register

{
    "code": 58,
    "message": "Not Implemented",
    "data": null
}
```

--- 

## 业务实现

### 更新Api

在`Api`中加入请求参数：
*api/users/v1/users.go*

```go
package v1

import "github.com/gogf/gf/v2/frame/g"

type RegisterReq struct {
    g.Meta   `path:"users/register" method:"post"`
    Username string `json:"username"`
    Password string `json:"password"`
    Email    string `json:"email"`
}
```

执行命令更新`Controller`：

```bash
$ gf gen ctrl
```

后续更改`Api`都需要执行此命令，为了省略篇幅，不再重复。

### 核心逻辑
所有业务的核心逻辑都应该存放在`internal/logic`下，供`Controller`层调用从而实现我们的业务逻辑。
*internal/logic/users/register.go*

```go
package users

import (
    "context"

    "star/internal/dao"
    "star/internal/model/do"
)

func Register(ctx context.Context, username, password, email string) error {
    _, err := dao.Users.Ctx(ctx).Data(do.Users{
        Username: username,
        Password: password,
        Email:    email,
    }).Insert()
    if err != nil {
        return err
    }
    return nil
}
```
### 控制器调用Logic

*internal/controller/users/users_v1_register.go*

```go
package users

import (
    "context"

    "star/internal/logic/users"

    "star/api/users/v1"
)

func (c *ControllerV1) Register(ctx context.Context, req *v1.RegisterReq) (res *v1.RegisterRes, err error) {
    err = users.Register(ctx, req.Username, req.Password, req.Email)
    return nil, err
}
```

`gf run main.go`会实时热更新项目，代码编写完成后发起一个`POST`请求：

```bash
$ curl -X POST http://127.0.0.1:8000/v1/users/register -H "Content-Type: application/json" -d "{\"username\":\"oldme\", \"password\":\"123456\", \"email\":\"tyyn1022@gmail.com\"}"

{
    "code":0,
    "message":"",
    "data":null
}
```

`code`为`0`代表成功，去数据库查看是否插入了一条数据：

```sql
SELECT * FROM users;
```

| ID  | Username | Password | Email              | Created_At          | Updated_At          |
| --- | -------- | -------- | ------------------ | ------------------- | ------------------- |
| 1   | oldme    | 123456   | tyyn1022@gmail.com | 2024-11-08 10:36:48 | 2024-11-08 10:36:48 |

`Created_At`和`Updated_At`两个字段会被`ORM`自动维护，分表代表创建时间和修改时间。
